/*!
 * @project : lego-antiHijack
 * @version : 0.1.0
 * @author  : UED.David
 * @update  : 2017-10-09 3:35:14 pm
 */!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="./js/",e(0)}([function(t,e,n){function r(t){return t&&t.__esModule?t:{"default":t}}var i=n(1),o=r(i);new o["default"]({whiteList:["yy.com"],blackList:["51.la","61.160.200.252"],reportUrl:"http://s1.yy.com/ued_web_static/common/img/blank.png"})},function(t,e,n){function r(t){return t&&t.__esModule?t:{"default":t}}var i=n(2),o=r(i),u=n(3),a=r(u),c=n(22),s=n(23),f=null;t.exports=function(){function t(e){(0,o["default"])(this,t),this.init(e)}return(0,a["default"])(t,[{key:"init",value:function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.defaults={whiteList:["yy.com","yypm.com","duowan.com","dwstatic.com","yystatic.com","huanju.cn","huanju.net","hiido.com","hiido.cn","huya.com","mezhibo.com","zhiniu8.com","100.com","5253.com","4366.com","1931.com","sealdsp.com","yuanyuantv.com","ruixueys.com","yyclouds.com","kuaikuai.cn","up24.com","bigo.tv","bigolive.cn","baidu.com","qq.com","weibo.com","sina.com.cn","sinaimg.cn","sinajs.cn","google-analytics.com"],blackList:["120.80.57.123","61.160.200.252"]},this.ready(),this.lockCall(),this.lockApply(),this.setSecurityList(t),this.rawDocumentWrite(),this.rawOpener(),this.rawSetAttribute(),this.checkIframeHijack(),this.mutation(),s.init(t)}},{key:"ready",value:function n(){this.whiteList=[],this.blackList=[],f=this}},{key:"render",value:function r(){}},{key:"beforeDestroy",value:function i(){}},{key:"destroyed",value:function u(){}},{key:"setSecurityList",value:function l(t){this.whiteList=t.whiteList&&c.isArray(t.whiteList)?c.mergeArray(this.defaults.whiteList,t.whiteList):this.defaults.whiteList,this.blackList=t.blackList&&c.isArray(t.blackList)?c.mergeArray(this.defaults.blackList,t.blackList):this.defaults.blackList}},{key:"rawDocumentWrite",value:function p(){var t=this,e=arguments,n=document.write,r=document.writeln,i=function o(n,r){var i=t.getTestType(n);switch(i){case"xss":s.pushQueue("document write→xss","",n);break;case"blackList":s.pushQueue("document write→黑名单","",n);break;default:s.pushQueue("document write→未拦截","",n),r.apply(document,e)}};document.write=function(t){i(t,n)},document.writeln=function(t){i(t,r)}}},{key:"rawOpener",value:function h(){var t=this,e=arguments,n=window.open;window.open=function(r){var i=t.getTestType(r);return"whiteList"!==i?void s.pushQueue("window.open",r,""):void n.apply(window,e)}}},{key:"rawSetAttribute",value:function d(){var t=this,e=Element.prototype.setAttribute;Element.prototype.setAttribute=function(n,r){if("SCRIPT"===this.tagName&&/^src$/i.test(n)){var i=t.getTestType(r);if("whiteList"!==i)return void s.pushQueue(this.tagName,r,"")}e.apply(this,arguments)}}},{key:"xssTest",value:function y(t){var e=["xss","eHNz","&#120;&#115;&#115;","&#x78;&#x73;&#x73;","\\u0078\\u0073\\u0073","\\x78\\x73\\x73","\\170\\163\\163","data:text/html","alert\\(\\s*\\d+\\)","alert\\(test\\)","hacked","location.href","self.location","top.location","String.fromCharCode","document.cookie","(\\[\\].*){3,}"],n=new RegExp(this.getReg(e),"i");return!!n.test(t)}},{key:"getReg",value:function v(t){return"("+t.join("|")+")"}},{key:"getTestType",value:function m(t){var e=t.match(/(http:\/\/|https:\/\/)?([^\/]*)/)[2];return this.testList(this.blackList,e)?"blackList":this.testList(this.whiteList,e)?"whiteList":!!this.xssTest(t)&&"xss"}},{key:"testList",value:function w(t,e){var n=this.getReg(t);if(n){var r=new RegExp(n,"i");if(r.test(e))return!0}return!1}},{key:"removeRiskNode",value:function k(t){t.parentNode.removeChild(t)}},{key:"checkDOMHijack",value:function b(t){for(var e=null,n=t.addedNodes,r=0;r<n.length;r++){var i=n[r];switch(i.tagName){case"SCRIPT":case"IFRAME":if("IFRAME"===i.tagName&&i.srcdoc)s.pushQueue(i.tagName,i.src,i.srcdoc),this.removeRiskNode(i);else if(i.src){var o=this.getTestType(i.src);"whiteList"!==o&&(s.pushQueue(i.tagName,i.src,""),this.removeRiskNode(i))}break;case"IMG":if(i.src){var u=this.getTestType(i.src);"blackList"===u&&(s.pushQueue(i.tagName,i.src,""),this.removeRiskNode(i))}(i.onload&&this.xssTest(i.onload)||i.onerror&&this.xssTest(i.onerror))&&(s.pushQueue("IMG xss",i.src,i.onload||i.onerror),this.removeRiskNode(i));break;case"A":i.setAttribute("rel","noopener")}}}},{key:"checkIframeHijack",value:function g(){var t="iframe_hijack_redirected";if(c.getUrlParam(t))s.pushQueue("iframe重定向",location.href,"");else if(self!=top){var e=location.href.split("#");location.search?e[0]+="&"+t+"=1":e[0]+="?"+t+"=1";try{top.location=e.join("#")}catch(n){}}}},{key:"watchDOMChange",value:function x(t,e){var n=f;t.forEach(function(t){n.checkDOMHijack(t)})}},{key:"mutation",value:function L(){var t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(t){var e=new t(this.watchDOMChange),n={childList:!0,subtree:!0};e.observe(document,n)}}},{key:"lockCall",value:function j(){Object.defineProperty(Function.prototype,"call",{value:Function.prototype.call,writable:!1,configurable:!1,enumerable:!0})}},{key:"lockApply",value:function A(){Object.defineProperty(Function.prototype,"apply",{value:Function.prototype.apply,writable:!1,configurable:!1,enumerable:!0})}}]),t}()},function(t,e){"use strict";e.__esModule=!0,e["default"]=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var i=n(4),o=r(i);e["default"]=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o["default"])(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()},function(t,e,n){t.exports={"default":n(5),__esModule:!0}},function(t,e,n){n(6);var r=n(9).Object;t.exports=function i(t,e,n){return r.defineProperty(t,e,n)}},function(t,e,n){var r=n(7);r(r.S+r.F*!n(17),"Object",{defineProperty:n(13).f})},function(t,e,n){var r=n(8),i=n(9),o=n(10),u=n(12),a="prototype",c=function(t,e,n){var s=t&c.F,f=t&c.G,l=t&c.S,p=t&c.P,h=t&c.B,d=t&c.W,y=f?i:i[e]||(i[e]={}),v=y[a],m=f?r:l?r[e]:(r[e]||{})[a],w,k,b;f&&(n=e);for(w in n)k=!s&&m&&void 0!==m[w],k&&w in y||(b=k?m[w]:n[w],y[w]=f&&"function"!=typeof m[w]?n[w]:h&&k?o(b,r):d&&m[w]==b?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e[a]=t[a],e}(b):p&&"function"==typeof b?o(Function.call,b):b,p&&((y.virtual||(y.virtual={}))[w]=b,t&c.R&&v&&!v[w]&&u(v,w,b)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){var n=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(t,e,n){var r=n(11);t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){var r=n(13),i=n(21);t.exports=n(17)?function(t,e,n){return r.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var r=n(14),i=n(16),o=n(20),u=Object.defineProperty;e.f=n(17)?Object.defineProperty:function a(t,e,n){if(r(t),e=o(e,!0),r(n),i)try{return u(t,e,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var r=n(15);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){t.exports=!n(17)&&!n(18)(function(){return 7!=Object.defineProperty(n(19)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){t.exports=!n(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},function(t,e,n){var r=n(15),i=n(8).document,o=r(i)&&r(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,e,n){var r=n(15);t.exports=function(t,e){if(!r(t))return t;var n,i;if(e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;if("function"==typeof(n=t.valueOf)&&!r(i=n.call(t)))return i;if(!e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){t.exports={getUrlParam:function n(t,e){var n=new RegExp("[\\?&#]"+t+"=([^&#]+)","gi"),r=(e||location.href).match(n),i=void 0;return r&&r.length>0?(i=r[r.length-1].split("="),i&&i.length>1?i[1]:""):""},mergeArray:function r(t,e){for(var n=0;n<t.length;n++)for(var r=0;r<e.length;r++)t[n]===e[r]&&t.splice(n,1);for(var n=0;n<e.length;n++)t.push(e[n]);return t},isArray:function i(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}}},function(t,e){t.exports={queueArray:[],pushQueue:function n(t,e,r){this.queueArray?this.queueArray.push({type:t,url:e,code:r}):this.sendHijack(t,e,r)},sendHijack:function r(t,e,n){var r=t?t.toLowerCase():"",i=e?e:"",o=n?n:"",u='HTTP_hijack&report={"type": "'+r+'", "url": "'+i+'", "code": "'+o+'"}',a=this.reportUrl;if(a){var c=new Image;c.src=a+"?"+u}else window.errorReport&&window.errorReport(u)},init:function i(t){var e=this;this.reportUrl=t.reportUrl,window.addEventListener("load",function(){e.queueArray.forEach(function(t,n){e.sendHijack(t.type,t.url,t.code)}),e.queueArray=null})}}}]);